<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.maeumi.prj.personalcounsel.service.PersonalcounselMapper">


	<!-- user -->
	<select id="CounselorSelectList"
		resultType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">

		<!-- select cs.c_email, cs.ccg_name, c.c_name, c.c_gender, c.c_grade, c.c_password 
			from cs_category cs join counselor c on(cs.c_email = c.c_email) where cs.ccg_subname 
			= #{ccg_subname} -->


		select cs.c_email, cs.ccg_name, cs.ccg_subname, c.c_name, c.c_gender, c.c_grade, c.c_picture, c.c_picturepath,
		p.p_kakao, p.p_kakaoprice, p.p_zoom, p.p_zoomprice, p.p_phone ,p.p_phoneprice 
		
		from cs_category
		cs join counselor c on(cs.c_email = c.c_email) join price p
		on(cs.c_email = p.c_email) 
		where cs.ccg_subname = #{ccg_subname}
	</select>

	<!-- 상담사 상세페이지 -->
	<select id="CounselorSelect"
		parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO" resultType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">
		select cs.c_email, cs.ccg_name,cs.ccg_subname,c.c_name, c.c_gender, c.c_phone,c.c_picture,
		c.c_grade, p.p_kakao, p.p_kakaoprice, p.p_zoom, p.p_zoomprice,c.c_picturepath,
		p.p_phone ,p.p_phoneprice
		from cs_category cs join counselor c
		on(cs.c_email = c.c_email)
		join price p
		on(cs.c_email = p.c_email)
		where
		cs.c_email = #{c_email} and cs.ccg_subname = #{ccg_subname}
	</select>
	
	<!--카테고리 리스트 -->
	<select id="SubnameSelectList" parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO" resultType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">
		SELECT cs.ccg_subname
		FROM cs_category cs join counselor c
		ON(cs.c_email = c.c_email)
		JOIN price p
		ON(cs.c_email = p.c_email)
		WHERE
		cs.c_email = #{c_email}

	</select>
	
	
	
	<!-- counselor 개인상담관리 -->
	
	<select id="PersonalCounselList" parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO" resultType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">

		
		<!-- select m.m_nickname, m.m_email, re.c_email,re.pr_no, re.pr_date, re.pr_price, re.pr_time, re.pr_status,re.pr_type, re.ccg_subname, re.pc_report, re.pc_result
		from personal_reserve re  left outer join member m 
		on(re.m_email = m.m_email)
		where re.c_email = #{c_email}
		order by re.pr_no desc; -->
		
		select m.m_nickname, m.m_email, re.c_email,re.pr_no, re.pr_date, re.pr_price, re.pr_time, re.pr_status,re.pr_type, re.ccg_subname, re.pc_report, re.pc_result
		from personal_reserve re  left outer join member m 
		on(re.m_email = m.m_email)
		order by re.pr_no desc
	</select>
	
	<select id="PersonalCounselSelect" parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO" resultType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">
		select m.m_nickname, m.m_email, re.c_email,re.pr_no, re.pr_date, re.pr_price, re.pr_time, re.pr_status,re.pr_type, re.ccg_subname, re.pc_report, re.pc_result
		from personal_reserve re  left outer join member m 
		on(re.m_email = m.m_email)
        where pr_no= #{pr_no}
		order by re.pr_no desc
	</select>
	
	<!-- 상담일지 수정 -->
	<update id="PersonalCounselUpdate" parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">
		update personal_reserve
		set pc_report=#{pc_report}, pc_result=#{pc_result},pr_status='1'
		where pr_no = #{pr_no}
	</update>
	
	<!-- 상담일지 삭제 -->
	<delete id="PersonalCounselDelete" parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">
		delete from 
		personal_reserve
		where pr_no=#{pr_no}
	</delete>
	
	<insert id="personalCounselInsert" parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">
		        INSERT INTO PERSONAL_RESERVE(
                pr_no,
                c_email,
                m_email,
                pr_date,
                pr_price,
                pr_time,
                pr_status,
                pr_type,
                ccg_subname
                )
                VALUES(
                (SELECT NVL(MAX(pr_no),0)+1 FROM personal_reserve N),
                #{c_email},
                #{m_email},
                sysdate,
                #{pr_price},
                #{pr_time},
                '0',
                '이거 타입 ㅜㅜ',
                #{ccg_subname}
                )
	</insert>
	
	<select id="personalMax" resultType="int">
			 select max(pr_no) from personal_reserve
	</select> 
	
	
	<select id="counselorResultSelect" parameterType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO" resultType="co.maeumi.prj.personalcounsel.service.PersonalcounselVO">
				 SELECT * FROM PERSONAL_RESERVE WHERE PR_NO = #{pr_no}
	
	</select>
</mapper>