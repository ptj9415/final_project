<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.maeumi.prj.groupcounsel.service.GroupcounselMapper">
	<insert id="insertGroupCounsel"
		parameterType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
		INSERT INTO GROUP_COUNSEL(
		gc_no,
		c_email,
		gc_date,
		gc_startdate,
		gc_finaldate,
		gc_title,
		gc_type,
		gc_min_person,
		gc_max_person,
		gc_price,
		gc_time,
		gc_sumnail,
		gc_kakao,
		gc_infos,
		gc_status,
		gc_name
		)
		values(
		(SELECT NVL(MAX(GC_NO),0)+1 FROM GROUP_COUNSEL N),
		'이메일 세션값 들어감',
		#{gc_date},
		#{gc_startdate},
		#{gc_finaldate},
		#{gc_title},
		#{gc_type},
		#{gc_min_person},
		#{gc_max_person},
		#{gc_price},
		#{gc_time},
		#{gc_sumnail},
		#{gc_kakao},
		#{gc_infos},
		0,
		'네임값 세션 들어감'
		)
	</insert>

	<select id="groupSelectList"
		resultType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
		SELECT *
		FROM GROUP_COUNSEL
		ORDER BY GC_NO DESC
	</select>

	<select id="joinSelectList"
		resultType="co.maeumi.prj.groupcounsel.service.GroupcounselVO"
		parameterType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
		select m.m_nickname, m.m_email, r.gr_reservedate, r.gr_status, r.gr_subject,
		r.gr_no
		from member m join group_reserve r
		on(m.m_email = r.m_email)
		join group_counsel c
		on(r.gc_no = c.gc_no)
		where c.c_email = #{c_email}
		ORDER BY r.gr_no DESC

	</select>

	<select id="countGroupCounsel" resultType="int">
		SELECT COUNT(*)
		FROM GROUP_COUNSEL
	</select>

	<select id="pageSelectList"
		resultType="co.maeumi.prj.groupcounsel.service.GroupcounselVO"
		parameterType="co.maeumi.prj.service.Pagination">
		SELECT *
		FROM (
		SELECT ROWNUM RN, A.*
		FROM (SELECT * FROM group_counsel
		ORDER BY gc_no DESC

		) A
		)
		WHERE RN BETWEEN #{start} AND #{end}
	</select>

	<select id="searchpageSelectList"
		resultType="co.maeumi.prj.groupcounsel.service.GroupcounselVO"
		parameterType="co.maeumi.prj.service.Pagination">
		SELECT *
		FROM (
		SELECT ROWNUM RN, A.*
		FROM (SELECT * FROM group_counsel
		ORDER BY gc_no DESC
		) A
		)
		<where>
			RN BETWEEN #{start} AND #{end}
			<if test="gc_title != null">and gc_title like '%'||#{gc_title}||'%'</if>
			<if test="gc_startdate != null">and gc_startdate like '%'||#{gc_startdate}||'%'</if>
			<if test="gc_finaldate != null">and gc_finaldate like '%'||#{gc_finaldate}||'%'</if>
			<if test="gc_type != null">and gc_type like '%'||#{gc_type}||'%'</if>
			<if test="gc_status != null">and gc_status like '%'||#{gc_status}||'%'</if>
		</where>
	</select>

	<select id="searchcountGroupCounsel"
		parameterType="co.maeumi.prj.service.Pagination" resultType="int">
		select count(*)
		from group_counsel
		<where>
			1=1
			<if test="gc_title != null">and gc_title like '%'||#{gc_title}||'%'</if>
			<if test="gc_startdate != null">and gc_startdate like '%'||#{gc_startdate}||'%'</if>
			<if test="gc_finaldate != null">and gc_finaldate like '%'||#{gc_finaldate}||'%'</if>
			<if test="gc_status != null">and gc_status like '%'||#{gc_status}||'%'</if>
			<if test="gc_type != null">and gc_type like '%'||#{gc_type}||'%'</if>
		</where>
	</select>

	<update id="GroupUserDelete"
		parameterType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
		update group_reserve
		set gr_status = 1
		where gr_no = #{gr_no}
	</update>

	<select id="selectgroupRserve"
		parameterType="co.maeumi.prj.groupcounsel.service.GroupcounselVO"
		resultType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
		select gr_subject
		from group_reserve
		where gr_no = #{gr_no}
	</select>

	<select id="selectDetailList"
		parameterType="co.maeumi.prj.groupcounsel.service.GroupcounselVO"
		resultType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
		select *
		from group_counsel
		where gc_no = #{gc_no}
	</select>

	<update id="groupCounselResult"
		parameterType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
		update group_counsel
		set gc_report = #{gc_report}, gc_result = #{gc_result}
		where gc_no = #{gc_no}
	</update>
	
	<select id="selectUserGroup" parameterType="co.maeumi.prj.groupcounsel.service.GroupcounselVO" resultType="co.maeumi.prj.groupcounsel.service.GroupcounselVO">
			select * from group_counsel
			where gc_no = #{gc_no}
	</select>
</mapper>
